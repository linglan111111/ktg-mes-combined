(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-696d4a37"],{3528:function(e,t,n){"use strict";n.d(t,"j",(function(){return l})),n.d(t,"i",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"l",(function(){return s})),n.d(t,"g",(function(){return u})),n.d(t,"f",(function(){return d})),n.d(t,"h",(function(){return i})),n.d(t,"b",(function(){return c})),n.d(t,"k",(function(){return h})),n.d(t,"c",(function(){return m})),n.d(t,"d",(function(){return f})),n.d(t,"e",(function(){return p}));var r=n("b775");function l(e){return Object(r["a"])({url:"/system/role/list",method:"get",params:e})}function o(e){return Object(r["a"])({url:"/system/role/"+e,method:"get"})}function a(e){return Object(r["a"])({url:"/system/role",method:"post",data:e})}function s(e){return Object(r["a"])({url:"/system/role",method:"put",data:e})}function u(e){return Object(r["a"])({url:"/system/role/dataScope",method:"put",data:e})}function d(e,t){const n={roleId:e,status:t};return Object(r["a"])({url:"/system/role/changeStatus",method:"put",data:n})}function i(e){return Object(r["a"])({url:"/system/role/"+e,method:"delete"})}function c(e){return Object(r["a"])({url:"/system/role/authUser/allocatedList",method:"get",params:e})}function h(e){return Object(r["a"])({url:"/system/role/authUser/unallocatedList",method:"get",params:e})}function m(e){return Object(r["a"])({url:"/system/role/authUser/cancel",method:"put",data:e})}function f(e){return Object(r["a"])({url:"/system/role/authUser/cancelAll",method:"put",params:e})}function p(e){return Object(r["a"])({url:"/system/role/authUser/selectAll",method:"put",params:e})}},"5ec0":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.showFlag?n("el-dialog",{attrs:{title:"安灯呼叫配置",visible:e.showFlag,modal:!1,width:"60%",center:""},on:{"update:visible":function(t){e.showFlag=t}}},[n("el-row",{staticClass:"mb8",attrs:{gutter:10}},[n("el-col",{attrs:{span:1.5}},[n("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["mes:pro:andonconfig:add"],expression:"['mes:pro:andonconfig:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:e.handleAdd}},[e._v("新增")])],1),n("right-toolbar",{attrs:{showSearch:e.showSearch},on:{"update:showSearch":function(t){e.showSearch=t},"update:show-search":function(t){e.showSearch=t},queryTable:e.getList}})],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.andonconfigList}},[n("el-table-column",{attrs:{type:"index"}}),n("el-table-column",{attrs:{label:"呼叫原因","render-header":e.addRedStar,align:"center",prop:"andonReason"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{attrs:{type:"textarea"},model:{value:t.row.andonReason,callback:function(n){e.$set(t.row,"andonReason",n)},expression:"scope.row.andonReason"}})]}}],null,!1,2395126911)}),n("el-table-column",{attrs:{label:"级别","render-header":e.addRedStar,align:"center",prop:"andonLevel"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-select",{model:{value:t.row.andonLevel,callback:function(n){e.$set(t.row,"andonLevel",n)},expression:"scope.row.andonLevel"}},e._l(e.dict.type.mes_andon_level,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}],null,!1,4002960811)}),n("el-table-column",{attrs:{label:"角色",align:"center",prop:"handlerRoleName"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-select",{attrs:{placeholder:"请选择角色"},on:{change:function(n){return e.handleRoleSelected(t.row)}},model:{value:t.row.handlerRoleName,callback:function(n){e.$set(t.row,"handlerRoleName",n)},expression:"scope.row.handlerRoleName"}},e._l(e.rolesOptions,(function(e){return n("el-option",{key:e.roleId,attrs:{label:e.roleName,value:e.roleName,disabled:1==e.status}})})),1)]}}],null,!1,3178468261)}),n("el-table-column",{attrs:{label:"处置人",align:"center",prop:"handlerNickName"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{attrs:{placeholder:"请选择处置人"},model:{value:t.row.handlerNickName,callback:function(n){e.$set(t.row,"handlerNickName",n)},expression:"scope.row.handlerNickName"}},[n("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(n){return e.handleUserSelect(t.$index)}},slot:"append"})],1)]}}],null,!1,2965321962)}),n("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["mes:pro:andonconfig:remove"],expression:"['mes:pro:andonconfig:remove']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(n){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}],null,!1,3115693371)})],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 定")]),n("el-button",{on:{click:function(t){e.showFlag=!1}}},[e._v("关 闭")])],1),n("UserSingleSelect",{ref:"userSelect",on:{onSelected:e.onUserSelected}})],1):e._e()},l=[],o=(n("e9f5"),n("f665"),n("7d54"),n("b775"));function a(e){return Object(o["a"])({url:"/mes/pro/andonconfig/list",method:"get",params:e})}function s(e){return Object(o["a"])({url:"/mes/pro/andonconfig",method:"put",data:e})}function u(e){return Object(o["a"])({url:"/mes/pro/andonconfig/"+e,method:"delete"})}var d=n("3528"),i=n("8198"),c={name:"Andonconfig",components:{UserSingleSelect:i["a"]},dicts:["mes_andon_level"],props:{configId:null,optType:null},watch:{configId(){this.queryParams.configId=this.configId}},data(){return{showFlag:!1,selectedRow:null,loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,andonconfigList:[],rolesOptions:[],title:"",open:!1,queryParams:{pageNum:1,pageSize:10,configId:null,andonReason:null,andonLevel:null,handlerRoleId:null,handlerRoleName:null,handlerUserId:null,handlerUserName:null,handlerNickName:null},form:{},rules:{andonReason:[{required:!0,message:"呼叫原因不能为空",trigger:"blur"}],andonLevel:[{required:!0,message:"级别不能为空",trigger:"blur"}]}}},created(){this.getList(),this.getRoles()},methods:{addRedStar(e,{column:t}){return[e("span",{style:"color:red"},"*"),e("span"," "+t.label)]},handleOpen(){this.showFlag=!0,this.getList(),this.getRoles()},getRoles(){Object(d["j"])().then(e=>{this.rolesOptions=e.rows})},getList(){this.loading=!0,a(this.queryParams).then(e=>{this.andonconfigList=e.data,this.loading=!1})},cancel(){this.showFlag=!1},reset(){this.form={configId:null,andonReason:null,andonLevel:null,handlerRoleId:null,handlerRoleName:null,handlerUserId:null,handlerUserName:null,handlerNickName:null,remark:null,attr1:null,attr2:null,attr3:null,attr4:null,createBy:null,createTime:null,updateBy:null,updateTime:null},this.resetForm("form")},handleQuery(){this.queryParams.pageNum=1,this.getList()},resetQuery(){this.resetForm("queryForm"),this.handleQuery()},handleAdd(){var e={configId:null,andonReason:null,andonLevel:null,handlerRoleId:null,handlerRoleName:null,handlerUserId:null,handlerUserName:null,handlerNickName:null,remark:null,createTime:null,updateBy:null,updateTime:null,flag:"add"};this.andonconfigList.unshift(e)},confirm(){if(this.andonconfigList.length>0){this.loading=!0;let e=!0;this.andonconfigList.forEach(t=>null==t.andonReason||""==t.andonReason?(this.$message.error("呼叫原因不能为空"),this.loading=!1,void(e=!1)):null==t.andonLevel||""==t.andonLevel?(this.$message.error("级别不能为空"),this.loading=!1,void(e=!1)):null!=t.handlerNickName&&""!=t.handlerNickName||null!=t.handlerRoleId&&""!=t.handlerRoleId?void 0:(this.$message.error("请选择处置人或角色"),this.loading=!1,void(e=!1))),e&&s(this.andonconfigList).then(e=>{this.$modal.msgSuccess("修改成功"),200===e.code&&(this.showFlag=!1,this.getList())},e=>{this.loading=!1})}},handleDelete(e,t){const n=t.configId||this.ids;let r=this;this.$modal.confirm("确认删除配置项？").then((function(){r.andonconfigList.forEach((function(t,l,o){l==e&&("add"==r.andonconfigList[e].flag?r.andonconfigList.splice(e,1):u(n).then(e=>{r.getList()}))}))}))},handleUserSelect(e){this.selectedRow=e,this.$refs.userSelect.showFlag=!0},onUserSelected(e){this.andonconfigList[this.selectedRow].handlerNickName=e.nickName,this.andonconfigList[this.selectedRow].handlerUserId=e.userId,this.andonconfigList[this.selectedRow].handlerUserName=e.userName},handleRoleSelected(e){const t=this.rolesOptions.find(t=>t.roleName===e.handlerRoleName);t&&(e.handlerRoleId=t.roleId)}}},h=c,m=n("2877"),f=Object(m["a"])(h,r,l,!1,null,null,null);t["default"]=f.exports},c0c7:function(e,t,n){"use strict";n.d(t,"g",(function(){return o})),n.d(t,"e",(function(){return a})),n.d(t,"a",(function(){return s})),n.d(t,"j",(function(){return u})),n.d(t,"c",(function(){return d})),n.d(t,"h",(function(){return i})),n.d(t,"b",(function(){return c})),n.d(t,"f",(function(){return h})),n.d(t,"k",(function(){return m})),n.d(t,"l",(function(){return f})),n.d(t,"m",(function(){return p})),n.d(t,"d",(function(){return g})),n.d(t,"i",(function(){return b}));var r=n("b775"),l=n("c38a");function o(e){return Object(r["a"])({url:"/system/user/list",method:"get",params:e})}function a(e){return Object(r["a"])({url:"/system/user/"+Object(l["e"])(e),method:"get"})}function s(e){return Object(r["a"])({url:"/system/user",method:"post",data:e})}function u(e){return Object(r["a"])({url:"/system/user",method:"put",data:e})}function d(e){return Object(r["a"])({url:"/system/user/"+e,method:"delete"})}function i(e,t){const n={userId:e,password:t};return Object(r["a"])({url:"/system/user/resetPwd",method:"put",data:n})}function c(e,t){const n={userId:e,status:t};return Object(r["a"])({url:"/system/user/changeStatus",method:"put",data:n})}function h(){return Object(r["a"])({url:"/system/user/profile",method:"get"})}function m(e){return Object(r["a"])({url:"/system/user/profile",method:"put",data:e})}function f(e,t){const n={oldPassword:e,newPassword:t};return Object(r["a"])({url:"/system/user/profile/updatePwd",method:"put",params:n})}function p(e){return Object(r["a"])({url:"/system/user/profile/avatar",method:"post",data:e})}function g(e){return Object(r["a"])({url:"/system/user/authRole/"+e,method:"get"})}function b(e){return Object(r["a"])({url:"/system/user/authRole",method:"put",params:e})}},fcb7:function(e,t,n){"use strict";n.d(t,"d",(function(){return l})),n.d(t,"e",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"g",(function(){return s})),n.d(t,"f",(function(){return u})),n.d(t,"a",(function(){return d})),n.d(t,"h",(function(){return i})),n.d(t,"b",(function(){return c}));var r=n("b775");function l(e){return Object(r["a"])({url:"/system/dept/list",method:"get",params:e})}function o(e){return Object(r["a"])({url:"/system/dept/list/exclude/"+e,method:"get"})}function a(e){return Object(r["a"])({url:"/system/dept/"+e,method:"get"})}function s(){return Object(r["a"])({url:"/system/dept/treeselect",method:"get"})}function u(e){return Object(r["a"])({url:"/system/dept/roleDeptTreeselect/"+e,method:"get"})}function d(e){return Object(r["a"])({url:"/system/dept",method:"post",data:e})}function i(e){return Object(r["a"])({url:"/system/dept",method:"put",data:e})}function c(e){return Object(r["a"])({url:"/system/dept/"+e,method:"delete"})}}}]);