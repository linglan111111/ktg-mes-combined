(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fbd34fe2","chunk-2d0b61c3"],{"058d":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},["view"!=t.optType?i("el-row",{staticClass:"mb8",attrs:{gutter:10}},[i("el-col",{attrs:{span:1.5}},[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["mes:md:mditem:add"],expression:"['mes:md:mditem:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:t.handleAdd}},[t._v("新增")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["mes:md:mditem:remove"],expression:"['mes:md:mditem:remove']"}],attrs:{type:"danger",plain:"",icon:"el-icon-delete",size:"mini",disabled:t.multiple},on:{click:t.handleDelete}},[t._v("删除")])],1),i("right-toolbar",{attrs:{showSearch:t.showSearch},on:{"update:showSearch":function(e){t.showSearch=e},"update:show-search":function(e){t.showSearch=e},queryTable:t.getList}})],1):t._e(),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.printerconfigList},on:{"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),i("el-table-column",{attrs:{label:"打印机编号",align:"center",prop:"printerCode","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["print:printerconfig:query"],expression:"['print:printerconfig:query']"}],attrs:{type:"text"},on:{click:function(i){return t.handleView(e.row)}}},[t._v(t._s(e.row.printerCode))])]}}])}),i("el-table-column",{attrs:{label:"是否默认",align:"center",prop:"defaultFlag"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("dict-tag",{attrs:{options:t.dict.type.sys_yes_no,value:e.row.defaultFlag}})]}}])}),i("el-table-column",{attrs:{label:"打印机类型",align:"center",prop:"printerType"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("dict-tag",{attrs:{options:t.dict.type.mes_printer_type,value:e.row.printerType}})]}}])}),i("el-table-column",{attrs:{label:"打印机名称",align:"center",prop:"printerName"}}),i("el-table-column",{attrs:{label:"品牌",align:"center",prop:"brand"}}),i("el-table-column",{attrs:{label:"型号",align:"center",prop:"printerModel"}}),i("el-table-column",{attrs:{label:"连接类型",align:"center",prop:"connectionType"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("dict-tag",{attrs:{options:t.dict.type.mes_conn_type,value:e.row.connectionType}})]}}])}),i("el-table-column",{attrs:{label:"打印机IP",align:"center",prop:"printerIp"}}),i("el-table-column",{attrs:{label:"打印机端口",align:"center",prop:"printerPort"}}),i("el-table-column",{attrs:{label:"启用状态",align:"center",prop:"enableFlag"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("dict-tag",{attrs:{options:t.dict.type.sys_yes_no,value:e.row.enableFlag}})]}}])}),i("el-table-column",{attrs:{label:"打印机状态",align:"center",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("dict-tag",{attrs:{options:t.dict.type.mes_printer_status,value:e.row.status}})]}}])}),"view"!=t.optType?i("el-table-column",{attrs:{label:"操作",align:"center",width:"200px","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["mes:md:mditem:edit"],expression:"['mes:md:mditem:edit']"}],attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(i){return t.handleUpdate(e.row)}}},[t._v("修改")]),i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["mes:md:mditem:remove"],expression:"['mes:md:mditem:remove']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(i){return t.handleDelete(e.row)}}},[t._v("删除")]),"Y"!=e.row.defaultFlag?i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["print:printerconfig:list"],expression:"['print:printerconfig:list']"}],attrs:{size:"mini",type:"text",icon:"el-icon-star-off"},on:{click:function(i){return t.handleDefault(e.row)}}},[t._v("设置为默认")]):t._e()]}}],null,!1,3684476485)}):t._e()],1),i("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.queryParams.pageNum,limit:t.queryParams.pageSize},on:{"update:page":function(e){return t.$set(t.queryParams,"pageNum",e)},"update:limit":function(e){return t.$set(t.queryParams,"pageSize",e)},pagination:t.getList}}),i("el-dialog",{attrs:{title:t.title,visible:t.open,width:"50%","append-to-body":""},on:{"update:visible":function(e){t.open=e}}},[i("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"100px"}},[i("el-row",[i("el-col",{attrs:{span:16}},[i("el-row",[i("el-col",{attrs:{span:16}},[i("el-form-item",{attrs:{label:"打印机编号",prop:"printerCode"}},[i("el-input",{attrs:{placeholder:"请输入打印机编号"},model:{value:t.form.printerCode,callback:function(e){t.$set(t.form,"printerCode",e)},expression:"form.printerCode"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{"label-width":"80"}},["view"!=t.optType?i("el-switch",{attrs:{"active-color":"#13ce66","active-text":"自动生成"},on:{change:function(e){return t.handleAutoGenChange(t.autoGenFlag)}},model:{value:t.autoGenFlag,callback:function(e){t.autoGenFlag=e},expression:"autoGenFlag"}}):t._e()],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"打印机名称",prop:"printerName"}},[i("el-select",{attrs:{placeholder:"请选择打印机"},model:{value:t.form.printerName,callback:function(e){t.$set(t.form,"printerName",e)},expression:"form.printerName"}},t._l(t.printerList,(function(t){return i("el-option",{key:t.name,attrs:{label:t.displayName,value:t.name}})})),1)],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"打印机类型",prop:"printerType"}},[i("el-select",{attrs:{placeholder:"请选择打印机类型"},model:{value:t.form.printerType,callback:function(e){t.$set(t.form,"printerType",e)},expression:"form.printerType"}},t._l(t.dict.type.mes_printer_type,(function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"启用状态",prop:"enableFlag"}},[i("el-radio-group",{model:{value:t.form.enableFlag,callback:function(e){t.$set(t.form,"enableFlag",e)},expression:"form.enableFlag"}},t._l(t.dict.type.sys_yes_no,(function(e){return i("el-radio",{key:e.value,attrs:{label:e.value}},[t._v(t._s(e.label))])})),1)],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"品牌",prop:"brand"}},[i("el-input",{attrs:{placeholder:"请输入品牌"},model:{value:t.form.brand,callback:function(e){t.$set(t.form,"brand",e)},expression:"form.brand"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"型号",prop:"printerModel"}},[i("el-input",{attrs:{placeholder:"请输入型号"},model:{value:t.form.printerModel,callback:function(e){t.$set(t.form,"printerModel",e)},expression:"form.printerModel"}})],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"打印机IP",prop:"printerIp"}},[i("el-input",{attrs:{placeholder:"请输入打印机IP"},model:{value:t.form.printerIp,callback:function(e){t.$set(t.form,"printerIp",e)},expression:"form.printerIp"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"打印机端口",prop:"printerPort"}},[i("el-input",{attrs:{placeholder:"请输入打印机端口"},model:{value:t.form.printerPort,callback:function(e){t.$set(t.form,"printerPort",e)},expression:"form.printerPort"}})],1)],1)],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"图片URL",prop:"printerUrl"}},[i("ImageUpload",{attrs:{limit:1,value:t.form.printerUrl,fileSize:5},on:{onUploaded:t.handleImgUplaoded,onRemoved:t.handleImgRemoved}})],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"打印机状态"}},[i("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.dict.type.mes_printer_status,(function(e){return i("el-radio",{key:e.value,attrs:{label:e.value}},[t._v(t._s(e.label))])})),1)],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"备注",prop:"remark"}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入内容"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1)],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["view"!=t.optType?i("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v("确 定")]):t._e(),i("el-button",{on:{click:t.cancel}},[t._v("关 闭")])],1)],1)],1)},r=[],l=(i("e9f5"),i("7d54"),i("ab43"),i("9d5b")),a=i("8171"),o=i("4863"),s={name:"PrintConfig",dicts:["mes_printer_status","mes_printer_type","mes_conn_type","sys_yes_no"],mixins:[o["a"]],data(){return{autoGenFlag:!1,loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,printerconfigList:[],printerList:[],title:"",open:!1,queryParams:{pageNum:1,pageSize:10,printerType:null,printerCode:null,printerName:null,brand:null,printerModel:null,connectionType:null,printerUrl:null,printerIp:null,printerPort:null,clientSid:null,clientIp:null,clientPort:null,enableFlag:null,status:null},form:{},rules:{printerCode:[{required:!0,message:"打印机编号不能为空",trigger:"blur"}],printerName:[{required:!0,message:"打印机名称不能为空",trigger:"blur"}],remark:[{max:250,message:"长度必须小于250个字符",trigger:"blur"}]}}},props:{optType:void 0,client:void 0},mounted(){this.queryParams.clientId=this.client.clientId,this.getList()},methods:{filterClient(){if(null!=this.hiprintThis.hiwebSocket.clients&&void 0!=this.hiprintThis.hiwebSocket.clients){const t=Object.entries(this.hiprintThis.hiwebSocket.clients);let e=!1;return t.forEach(t=>{const i=t[1].clientUrl.split(t[1].ip+":");t[1].ip==this.client.clientIp&&i[1]==this.client.clientPort&&(this.printerList=t[1].printerList,e=!0)}),!!e||(this.printerList=[],this.$message.warning("客户端未连接"),!1)}return this.printerList=[],this.$message.warning("中转站服务未启动"),!1},handleImgUplaoded(t){this.form.printerUrl=t},handleImgRemoved(t){this.form.printerUrl=null},handleDownloadClient(){const t="http://101.43.244.58:9090/api/v1/buckets/printtool/objects/download?prefix=UHJpbnQuZXhl";this.$download.saveAs(t,"client")},handleDefault(t){Object(l["f"])(t).then(t=>{200==t.code&&(this.getList(),this.$modal.msgSuccess("设置成功!"))})},getList(){this.loading=!0,Object(l["e"])(this.queryParams).then(t=>{this.printerconfigList=t.rows,this.total=t.total,this.loading=!1})},cancel(){this.open=!1,this.reset()},reset(){this.form={printerId:null,printerCode:null,printerType:null,printerName:null,brand:null,printerModel:null,connectionType:"0",printerUrl:null,printerIp:null,printerPort:null,clientSid:null,clientIp:null,clientPort:null,enableFlag:"Y",status:"READY",remark:null,attr1:null,attr2:null,attr3:null,attr4:null,createBy:null,createTime:null,updateBy:null,updateTime:null},this.resetForm("form")},handleQuery(){this.queryParams.pageNum=1,this.getList()},resetQuery(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange(t){this.ids=t.map(t=>t.printerId),this.single=1!==t.length,this.multiple=!t.length},handleAdd(){this.filterClient()&&(this.reset(),this.open=!0,this.title="添加打印机配置",this.optType="add")},handleUpdate(t){if(this.filterClient()){this.reset();const e=t.printerId||this.ids;Object(l["d"])(e).then(t=>{this.form=t.data,this.open=!0,this.title="修改打印机配置",this.optType="edit"})}},handleView(t){if(this.filterClient()){this.reset();const e=t.printerId||this.ids;Object(l["d"])(e).then(t=>{this.form=t.data,this.open=!0,this.title="查看打印机配置",this.optType="view"})}},submitForm(){this.$refs["form"].validate(t=>{t&&(this.form.clientId=this.client.clientId,null!=this.form.printerId?Object(l["g"])(this.form).then(t=>{this.$modal.msgSuccess("修改成功"),this.open=!1,this.getList()}):Object(l["a"])(this.form).then(t=>{this.$modal.msgSuccess("新增成功"),this.open=!1,this.getList()}))})},handleDelete(t){const e=t.printerId||this.ids;this.$modal.confirm('是否确认删除打印机配置编号为"'+e+'"的数据项？').then((function(){return Object(l["b"])(e)})).then(()=>{this.getList(),this.$modal.msgSuccess("删除成功")}).catch(()=>{})},handleAutoGenChange(t){t?Object(a["c"])("PRINTER_CODE").then(t=>{this.form.printerCode=t}):this.form.printerCode=null}}},d=s,p=i("2877"),u=Object(p["a"])(d,n,r,!1,null,null,null);e["default"]=u.exports},"1c83":function(t,e,i){"use strict";i.r(e),i.d(e,"aProvider",(function(){return r}));var n=i("0f64");const r=function(t){var e=function(t){t.removePrintElementTypes("defaultModule"),t.addPrintElementTypes("defaultModule",[new n["hiprint"].PrintElementTypeGroup("平台",[{tid:"defaultModule.text",title:"固定文本",data:"固定文本",type:"text",options:{type:"text",testData:"",height:12,fontSize:6.75,width:61.5,textAlign:"left",textContentVerticalAlign:"middle"}},{tid:"defaultModule.image",title:"",data:"",type:"image"},{tid:"defaultModule.longText",title:"长文本",data:"长文本",type:"longText",options:{type:"text",testData:"",height:12,fontSize:6.75,textAlign:"left",textContentVerticalAlign:"middle"}},{tid:"defaultModule.date",title:"",data:"2020-01-01",type:"text",options:{type:"date",field:"date",testData:"2020-01-01",height:16,fontSize:6.75,fontWeight:"700",textAlign:"left",textContentVerticalAlign:"middle"}},{tid:"defaultModule.hline",title:"横线",type:"hline",options:{width:90,height:9}},{tid:"defaultModule.vline",title:"竖线",type:"vline",options:{width:9,height:90}},{tid:"defaultModule.rect",title:"矩形",type:"rect",options:{width:66,height:42}},{tid:"defaultModule.oval",title:"椭圆",type:"oval",options:{width:60,height:60}},{tid:"defaultModule.barcode",title:"条形码",data:"",type:"text",options:{type:"barcode",field:"barcode",testData:"test",height:32,fontSize:12,lineHeight:18,textType:"barcode"}},{tid:"defaultModule.qrcode",title:"二维码",data:"",type:"text",options:{type:"qrcode",field:"barcodeContent",testData:"test",height:40,width:40,fontSize:12,lineHeight:18,hideTitle:!0,textType:"qrcode"}},{tid:"defaultModule.itemCode",title:"物料编码",data:"",type:"text",options:{testData:"IF2022082437",height:12,field:"itemCode",hideTitle:!0,fontSize:6.75,width:61.5,textAlign:"left",textContentVerticalAlign:"middle"}},{tid:"defaultModule.itemName",title:"物料名称",data:"",type:"text",options:{testData:"色粉【黑色】",field:"itemName",hideTitle:!0,height:12,fontSize:6.75,width:61.5,textAlign:"left",textContentVerticalAlign:"middle"}},{tid:"defaultModule.workorderCode",title:"工单编码",data:"",type:"text",options:{testData:"MO202503180014",field:"workorderCode",hideTitle:!0,height:12,fontSize:6.75,width:61.5,textAlign:"left",textContentVerticalAlign:"middle"}},{tid:"defaultModule.workorderName",title:"工单名称",data:"",type:"text",options:{testData:"螺丝刀刀头【10000】PCS",field:"workorderName",hideTitle:!0,height:12,fontSize:6.75,width:61.5,textAlign:"left",textContentVerticalAlign:"middle"}},{tid:"defaultModule.vendorCode",title:"供应商编码",data:"",type:"text",options:{testData:"V00009",field:"vendorCode",hideTitle:!0,height:12,fontSize:6.75,width:61.5,textAlign:"left",textContentVerticalAlign:"middle"}},{tid:"defaultModule.vendorName",title:"供应商名称",data:"",type:"text",options:{testData:"江苏南通塑有为塑料制品有限公司",field:"vendorName",hideTitle:!0,height:12,fontSize:6.75,width:61.5,textAlign:"left",textContentVerticalAlign:"middle"}},{tid:"defaultModule.clientCode",title:"客户编码",data:"",type:"text",options:{testData:"C00184",field:"clientCode",hideTitle:!0,height:12,fontSize:6.75,width:61.5,textAlign:"left",textContentVerticalAlign:"middle"}},{tid:"defaultModule.clientName",title:"客户名称",data:"",type:"text",options:{testData:"比亚迪股份有限公司",field:"clientName",hideTitle:!0,height:12,fontSize:6.75,width:61.5,textAlign:"left",textContentVerticalAlign:"middle"}}])])};return{addElementTypes:e}};e["default"]=r()},4863:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i("1c83"),r=i("0f64"),l=(i("fe63"),i("1ca4"));const a={data(){return{hiprintTemplate:null,hiprintThis:null}},mounted(){r["hiprint"].init({providers:[n["default"]],host:l["a"].print_transfer_url,token:l["a"].print_transfer_token}),this.hiprintThis=r["hiprint"],this.hiprintTemplate=new r["hiprint"].PrintTemplate}}},8171:function(t,e,i){"use strict";i.d(e,"c",(function(){return r})),i.d(e,"e",(function(){return l})),i.d(e,"d",(function(){return a})),i.d(e,"a",(function(){return o})),i.d(e,"f",(function(){return s})),i.d(e,"b",(function(){return d}));var n=i("b775");function r(t){return Object(n["a"])({url:"/system/autocode/get/"+t,method:"get"})}function l(t){return Object(n["a"])({url:"/system/autocode/rule/list",method:"get",params:t})}function a(t){return Object(n["a"])({url:"/system/autocode/rule/"+t,method:"get"})}function o(t){return Object(n["a"])({url:"/system/autocode/rule",method:"post",data:t})}function s(t){return Object(n["a"])({url:"/system/autocode/rule",method:"put",data:t})}function d(t){return Object(n["a"])({url:"/system/autocode/rule/"+t,method:"delete"})}},"9d5b":function(t,e,i){"use strict";i.d(e,"e",(function(){return r})),i.d(e,"d",(function(){return l})),i.d(e,"a",(function(){return a})),i.d(e,"g",(function(){return o})),i.d(e,"b",(function(){return s})),i.d(e,"f",(function(){return d})),i.d(e,"c",(function(){return p}));var n=i("b775");function r(t){return Object(n["a"])({url:"/print/printerconfig/list",method:"get",params:t})}function l(t){return Object(n["a"])({url:"/print/printerconfig/"+t,method:"get"})}function a(t){return Object(n["a"])({url:"/print/printerconfig",method:"post",data:t})}function o(t){return Object(n["a"])({url:"/print/printerconfig",method:"put",data:t})}function s(t){return Object(n["a"])({url:"/print/printerconfig/"+t,method:"delete"})}function d(t){return Object(n["a"])({url:"/print/printerconfig/editDefaultPrint/",method:"post",data:t})}function p(t){return Object(n["a"])({url:"/print/printerconfig/getDefaultPrint/"+t,method:"get"})}},fe63:function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));i("e9f5"),i("7d54"),i("5087");var n=i("5c96"),r=i("9d5b");function l(t,e,i,l){if(i)try{i.update(JSON.parse(t));const a=JSON.parse(localStorage.getItem("defaultClient")),o=Object.entries(l.hiwebSocket.clients);let s="";o.forEach(t=>{a.clientIp==t[1].ip&&(s=t[0])}),s?Object(r["c"])(a.clientId).then(t=>{200==t.code&&(i.print2(e,{client:s,printer:t.data.printerName,title:"hiprint测试打印"}),n["Message"].success("打印成功"))}).catch(t=>{}):n["Message"].error("客户端未连接,无法直接打印")}catch(a){n["Message"].error("更新失败: "+a)}}}}]);