(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f729011e","chunk-2895807e"],{"11dd":function(t,e,n){"use strict";n.d(e,"e",(function(){return s})),n.d(e,"d",(function(){return r})),n.d(e,"f",(function(){return i})),n.d(e,"c",(function(){return l})),n.d(e,"a",(function(){return o})),n.d(e,"g",(function(){return d})),n.d(e,"b",(function(){return u}));var a=n("b775");function s(t){return Object(a["a"])({url:"/mes/pro/protask/list",method:"get",params:t})}function r(t){return Object(a["a"])({url:"/mes/pro/protask/listGanttTaskList",method:"get",params:t})}function i(t){return Object(a["a"])({url:"/mes/pro/protask/listTaskListByWorkorder",method:"get",params:t})}function l(t){return Object(a["a"])({url:"/mes/pro/protask/"+t,method:"get"})}function o(t){return Object(a["a"])({url:"/mes/pro/protask",method:"post",data:t})}function d(t){return Object(a["a"])({url:"/mes/pro/protask",method:"put",data:t})}function u(t){return Object(a["a"])({url:"/mes/pro/protask/"+t,method:"delete"})}},"33cf":function(t,e,n){},"38b9":function(t,e,n){},"48fe":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("el-row",{staticClass:"mb8",attrs:{gutter:10}},[n("el-col",{attrs:{span:1}}),n("el-col",{attrs:{span:1.5}},[n("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["mes:pro:protask:edit"],expression:"['mes:pro:protask:edit']"}],attrs:{type:"success",plain:"",icon:"el-icon-edit",size:"mini"},on:{click:t.handleUpdate}},[t._v("保存")])],1),n("el-col",{attrs:{span:1.5}},[n("el-button",{attrs:{type:"danger",plain:"",icon:"el-icon-delete",size:"mini"},on:{click:t.handleClose}},[t._v("关闭")])],1),n("el-col",{attrs:{span:1.5}},[n("el-button",{attrs:{type:"warning",plain:"",icon:"el-icon-refresh",size:"mini"},on:{click:t.handleRefresh}},[t._v("重新加载")])],1)],1),n("div",{staticClass:"wrapper"},[n("div",{staticClass:"container"},[n("GanttChar",{ref:"ganttChar",staticClass:"left-container",attrs:{optType:"edit",ids:t.changedTaskIds,tasks:t.tasks}})],1)])],1)},s=[],r=(n("e9f5"),n("910d"),n("7d54"),n("b05b")),i=n("11dd"),l={name:"",components:{GanttChar:r["default"]},data(){return{tasks:{data:[],links:[]},changedTaskIds:[],optType:"edit",queryParams:{workorderCode:null,workorderName:null,orderSource:null,sourceCode:null,productId:null,productCode:null,productName:null,productSpc:null,unitOfMeasure:null,quantity:null,quantityProduced:null,quantityChanged:null,quantityScheduled:null,clientId:null,clientCode:null,clientName:null,requestDate:null,parentId:null,ancestors:null,status:null},form:{taskId:null,startTime:null,duration:null,endTime:null}}},watch:{tasks(){console.log("TaskChanged")}},created(){this.getGanttTasks()},methods:{getGanttTasks(){Object(i["d"])(this.queryParams).then(t=>{this.tasks.data=t.data.data,this.tasks.links=t.data.links,this.$refs.ganttChar.reload()})},handleUpdate(){this.changedTaskIds.length>0&&(this.reset(),this.changedTaskIds.forEach(t=>{let e=this.tasks.data.filter(e=>e.id==t)[0];if(e.id.startsWith("MO"))return;let n=new Date(e.start_date),a=new Date(e.end_date);this.form=e,this.form.taskId=e.id,this.form.startTime=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate()+" "+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds(),this.form.duration=e.duration,this.form.endTime=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds(),Object(i["g"])(this.form).then(e=>{console.log("update success:"+t),this.$modal.msgSuccess("保存成功")},t=>{console.log("update failed:"+t.msg),this.$modal.msgSuccess("保存失败")})}))},handleRefresh(){this.$refs.ganttChar.reload()},handleClose(){const t={path:"/mes/pro/proschedule"};this.$tab.closeOpenPage(t)},reset(){this.form={taskId:null,startTime:null,duration:null,endTime:null}}}},o=l,d=(n("4f1f"),n("2877")),u=Object(d["a"])(o,a,s,!1,null,"fcdf65c4",null);e["default"]=u.exports},"4f1f":function(t,e,n){"use strict";n("38b9")},b05b:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"gantt"})},s=[],r=(n("14d9"),n("e9f5"),n("910d"),n("6bfb")),i={name:"GanttChar",data(){return{newObj:{}}},props:{tasks:{type:Object,default(){return{data:[],links:[]}}},optType:{type:String,default(){return"view"}},ids:{type:Array,default(){return[]}}},created(){},mounted:function(){this.initConfig(),r["gantt"].plugins({marker:!0}),r["gantt"].init(this.$refs.gantt),r["gantt"].parse(this.tasks)},methods:{initData(){},reload(){r["gantt"].clearAll(),this.addTodayLine(),r["gantt"].parse(this.$props.tasks),r["gantt"].render()},addTodayLine(){var t=r["gantt"].date.date_to_str(r["gantt"].config.task_date),e=new Date;r["gantt"].addMarker({start_date:e,css:"today",text:"今天",title:"今天: "+t(e)})},initConfig(){"view"==this.optType?r["gantt"].config.readonly=!0:r["gantt"].config.readonly=!1,r["gantt"].config.duration_unit="hour",r["gantt"].config.duration_step=8,r["gantt"].config.grid_width=520,r["gantt"].config.columns=[{name:"text",label:"任务名",tree:!0,width:"200"},{name:"workstation",label:"工作站",align:"center",width:"*"},{name:"process",label:"工序",align:"center",width:"*"},{name:"start_date",label:"开始时间",align:"center",width:"*"},{name:"end_date",label:"结束时间",align:"center",width:"*"}],r["gantt"].i18n.setLocale("cn"),r["gantt"].plugins({tooltip:!0}),r["gantt"].templates.tooltip_text=function(t,e,n){return"project"==n.type?"<b style='text-align:left;'>生产工单:</b> "+n.text+"    <span style='text-align:left;'> 完成比例："+Math.round(100*n.progress)+"% </span>":"<b style='text-align:left;'>生产任务:</b> "+n.process+" "+n.text+"    <span style='text-align:left;'> 完成比例："+Math.round(100*n.progress)+"% </span>"},r["gantt"].config.open_tree_initially=!0,r["gantt"].templates.task_text=function(t,e,n){return"project"==n.type?"<b style='text-align:left;'>生产工单:</b> "+n.text+"    <span style='text-align:left;'> 完成比例："+Math.round(100*n.progress)+"% </span>":"<b style='text-align:left;'>生产任务:</b> "+n.process+" "+n.text+"    <span style='text-align:left;'> 完成比例："+Math.round(100*n.progress)+"% </span>"},r["gantt"].config.show_task_cells=!0;var t=function(t){var e=r["gantt"].date.date_to_str("%M %d"),n=r["gantt"].date.add(r["gantt"].date.add(t,1,"week"),-1,"day");return e(t)+" - "+e(n)},e=function(t){var e=r["gantt"].date.date_to_str("%M %d");r["gantt"].date.date_to_str("%D");return e(t)},n=function(t){return 0===t.getDay()||6===t.getDay()?"weekend":""};r["gantt"].config.scales=[{unit:"week",step:1,format:t},{unit:"day",step:1,format:e,css:n},{unit:"hour",step:8,format:"%H:%i"}],r["gantt"].config.scale_height=50,r["gantt"].config.xml_date="%Y-%m-%d %H:%i:%s",r["gantt"].config.auto_types=!1,r["gantt"].config.drag_progress=!1,r["gantt"].config.drag_move=!0,r["gantt"].config.drag_links=!1,r["gantt"].config.drag_resize=!0,r["gantt"].config.details_on_create=!0,r["gantt"].config.details_on_dblclick=!0,r["gantt"].config.fit_tasks=!0;let a=this.$props.tasks,s=this.$props.ids;r["gantt"].attachEvent("onAfterTaskUpdate",(function(t,e){let n=a.data.filter(e=>e.id==t);n=e,s.push(t)}))}}},l=i,o=(n("be6f"),n("2877")),d=Object(o["a"])(l,a,s,!1,null,null,null);e["default"]=d.exports},be6f:function(t,e,n){"use strict";n("33cf")}}]);